# 应用回归测试

当应用启动成功后，您需要通过业务功能回归测试，确认应用没有问题。

## 配置测试域名

在Kubernetes集群中，可以通过配置服务端口实现集群内部不同服务之间的相互调用，通过配置路由实现从集群外部访问集群服务。

而在配置路由时，可以配置多域名，包括生产域名（客户自己备案的域名，完整域名）和测试域名（由容器平台提供域名，提供域名前缀即可）。您可以按照以下方法进行操作。

1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。

2.  在控制台左侧导航栏中，单击**集群**。

3.  在集群列表页面中，单击目标集群名称或者目标集群右侧**操作**列下的**详情**。

4.  在集群管理页左侧导航栏中，单击**路由**。

5.  单击右上角的**创建**。

    创建路由的具体操作及参数说明，请参见[创建路由](/intl.zh-CN/Kubernetes集群用户指南/网络管理/Ingress管理/创建路由（Ingress）.md)。

6.  创建完成后，您可以在路由列表中看到对应访问域名及端点。

    **说明：** 此处创建的路由的访问端点即为与集群关联的SLB实例的公网IP地址。


## 测试业务功能

客户可以通过上述配置的测试域名或客户自己的备案域名（备案域名因尚未更新DNS解析到该SLB公网IP，需在本地做域名绑定）就可以访问Kubernetes集群提供的业务功能。示例域名如下：

![测试域名](../images/p48275.png "测试域名")

![用户备案域名](../images/p48276.png "用户备案域名")

**说明：** 请根据测试域名或备案域名完成业务功能回归测试，以保证新集群提供的业务服务没有问题。

## 确认应用日志

在[迁移应用日志配置](/intl.zh-CN/最佳实践/Swarm迁移Kubernetes/迁移应用配置/迁移应用日志配置.md)中，Swarm和Kubernetes的Logstore生成规则不同。所以，Swarm集群生成的应用日志和Kubernetes生成的应用日志在日志服务同个Project，不同Logstore下面。在测试过程中，可以查看Kubernetes创建的Logstore是否有业务日志输出，并确认输出是否正确。

1.  登录[日志服务控制台](https://sls.console.aliyun.com/?spm)，在**Project列表**区域，单击目标Project名称。

2.  在**日志库**页签，在Logstore列表中，可以看到对应的Logstore。

3.  单击**查询**，即可查看Kubernetes集群的日志信息，确认输出是否正常。


## 确认应用监控

在确认Kubernetes集群在新Logstore日志输出正常之后，需要进一步确认基于该日志Logstore基础之上的云监控、业务实时监控ARMS、消息投递存储等云产品是否正常配置，详情请参见[日志服务-实时消费](/intl.zh-CN/消费与投递/实时消费/简介.md)并按自身业务实际使用情况，确认各消费场景配置是否正常。

本例中，主要通过示例应用swarm-piggymetrics云监控中的主机监控和日志监控确认Kubernetes集群的服务运行情况，具体操作如下：

1.  查看主机监控。详情请参见[t6293.md\#](/intl.zh-CN/常见问题/产品使用问题/如何通过云监控控制台查看指定日期的监控数据.md)。

    在创建Kubernetes集群时，选择安装**云监控插件**，可以监控Kubernetes集群中各个Node节点机器的系统负载及网络监控信息，并从中观察测试流量是否有进入到新Kubernetes集群。

2.  查看日志监控。

    更详细的业务监控可以通过云日志监控或业务实时监控服务等云产品实现。这里以云监控中的日志监控为例，在原来Swarm集群的日志监控规则基础上，新创建一个日志监控**findAccountCount\_k8s**用于监听K8S集群的机器日志，并配置对应的解析规则，然后可以通过监控图表查看到有新的测试流量进入。

    **说明：** 通过上图，可以明显看到Kubernetes集群账户查询请求从无到有开始上涨，也验证了测试流量确实是由新集群k8s-piggymetrics-cluster在对外提供服务。


