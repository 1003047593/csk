# 在容器组中使用密钥 {#concept_e2n_vkn_vdb .concept}

您可以在 Pod 中使用密钥，有多种使用场景，主要包括：

-   使用密钥配置Pod的数据卷
-   使用密钥设置Pod的环境变量

更多关于密钥的信息，可以参见 [密钥](https://kubernetes.io/zh/docs/concepts/configuration/secret/)。

## 前提条件 {#section_gtv_cln_vdb .section}

-   您在 Pod 里使用密钥时，需要两者处于同一集群和命名空间中。
-   您已连接到Kubernetes集群的Master节点，参见[通过 kubectl 连接 Kubernetes 集群](intl.zh-CN/用户指南/Kubernetes集群/集群管理/通过 kubectl 连接 Kubernetes 集群.md#)。

## 创建密钥 {#section_htv_cln_vdb .section}

本示例创建密钥 secret-test。

1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。
2.  在 Kubernetes 菜单下，单击左侧导航栏中的**应用** \> **无状态**，然后单击右上角的**使用模板创建**。
3.  选择所需的集群和命名空间，选择样例模板或自定义，然后单击**创建**。

    您可以使用如下 yaml 示例模板创建密钥。

    ``` {#codeblock_vbs_8eh_97l}
    apiVersion: v1
    kind: Secret
    metadata:
      name: secret-test
    type: Opaque
    data:
      username: admin
      password: 12345  #需要用Base64编码
    ```


您也可以通过 Web 界面创建密钥，请参见[创建密钥](intl.zh-CN/用户指南/Kubernetes集群/配置项及密钥管理/创建密钥.md#)。

## 使用密钥配置 pod 数据卷 {#section_x41_rnn_vdb .section}

以下两种配置方法您可任选其一进行配置。

密钥可以在Pod中作为文件使用。如示例所示， secret-test密钥的username和password以文件方式保存在/srt目录下。

``` {#codeblock_s6g_a92_y8b}
apiVersion: v1
kind: Pod
metadata:
  name: pod0
spec:
  containers:
  - name: redis
    image: redis
    volumeMounts:
    - name: srt
      mountPath: "/srt "
      readOnly: true
  volumes:
  - name: srt
    secret:
      secretName: secret-test
```

1.  通过执行kubectl命令`kubectl apply -f <example0.yaml>`进行配置。

    **Note:** 此处的example0.yaml需要替换成实际yaml文件的名称。

2.  通过容器服务控制台进行配置。
    1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。
    2.  在 Kubernetes 菜单下，单击左侧导航栏中的**应用** \> **无状态**，单击右上角的**使用镜像创建**。请参考[镜像创建无状态Deployment应用](intl.zh-CN/用户指南/Kubernetes集群/应用管理/镜像创建无状态Deployment应用.md#)。

        本例中，在**容器配置**页签，在**数据卷**区域，单击**增加本地存储**，存储卷类型为保密字典，挂载源为[创建密钥](#section_htv_cln_vdb)中创建好的密钥，容器路径为在容器中访问的路径。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/531954/156142795749492_zh-CN.png)


## 使用密钥设置Pod的环境变量 {#section_v19_8gc_ijm .section}

以下两种配置方法您可任选其一进行配置。

本例中， secret-test密钥中user和password设置为Pod的环境变量。

``` {#codeblock_9kb_6rr_wjl}
apiVersion: v1
kind: Pod
metadata:
  name: pod1
spec:
  containers:
  - name: redis
    image: redis
    env:
      - name: USERNAME
        valueFrom:
          secretKeyRef:
            name: secret-test
            key: username
      - name: PASSWORD
        valueFrom:
          secretKeyRef:
            name: secret-test
            key: password
```

1.  通过执行kubectl命令`kubectl apply -f <example1.yaml>`进行配置。

    **Note:** 此处的example1.yaml需要替换成实际yaml文件的名称。

2.  通过容器服务控制台进行配置。
    1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。
    2.  在 Kubernetes 菜单下，单击左侧导航栏中的**应用** \> **无状态**，单击右上角的**使用镜像创建**。请参考[镜像创建无状态Deployment应用](intl.zh-CN/用户指南/Kubernetes集群/应用管理/镜像创建无状态Deployment应用.md#)。

        本例中，在**容器配置**页签，在**环境变量**区域，单击![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/531954/156142795749493_zh-CN.png)，类型为密钥，变量引用为[创建密钥](#section_htv_cln_vdb)中创建好的密钥，在分别选择使用的key并填写好变量名称。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/531954/156142795749494_zh-CN.png)


