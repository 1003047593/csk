# 部署集群联邦 {#task_593309 .task}

-   您已经成功创建两个 Kubernetes 集群，参见[创建Kubernetes集群](intl.zh-CN/用户指南/Kubernetes集群/集群管理/创建Kubernetes集群.md#)。
-   通过[CloudShell](intl.zh-CN/用户指南/Kubernetes集群/集群管理/在CloudShell上通过kubectl管理Kubernetes集群.md#) 连接 Kubernetes 集群。
-   您已经安装[kuberfedctl](https://github.com/kubernetes-sigs/kubefed/releases)工具，且 kubefedctl 工具的版本与联邦服务版本相[配套](https://github.com/kubernetes-sigs/kubefed/releases)。

1.  部署联邦服务。 
    1.  登录[容器服务管理控制台](https://cs.console.aliyun.com/)。
    2.  在 Kubernetes 菜单下，选择**市场** \> **应用目录**，在右侧单击**ack-federation-v2**。 

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/475962/156042748248996_zh-CN.png)

    3.  在应用目录 -ack-federation-v2中，单击**参数**，可以通过修改参数配置进行定制化，如下所示。 

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/476685/156042748249000_zh-CN.png)

        **说明：** resources下相关配置为federation-controller-manager服务资源限制配置，您可以根据接入集群大小进行配置，其他保持默认值即可。

    4.  在右侧的创建页面，在右侧选择federation主集群**cluster1**，同时可以看到命名空间已设定为federation-system，发布名称已设定为federation-v2，然后单击**创建**。 几秒钟后，在弹出Helm 发布列表 - federation-v2页面，可以看到联邦服务在集群中被创建出来。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/475962/156042748348998_zh-CN.png)

2.  配置多集群。 
    1.  以cluster1为主集群，执行`kubectl config get-contexts`命令，看到如下信息时，表示已配置完成。 

        ``` {#codeblock_ix0_2u5_6u2}
        CURRENT   NAME       CLUSTER    AUTHINFO            NAMESPACE
        *         cluster1   cluster1   kubernetes-admin1
                  cluster2   cluster2   kubernetes-admin2
        ```

    2.  执行如下命令，组建federation集群。 

        ``` {#codeblock_jr7_6q8_atb}
        kubefedctl join cluster1 --cluster-context cluster1 \
            --host-cluster-context cluster1 --add-to-registry --v=2
        kubefedctl join cluster2 --cluster-context cluster2 \
            --host-cluster-context cluster1 --add-to-registry --v=2
        ```

        **说明：** 如果有三个及以上集群，请参考上面第二条命令将集群加入到集群联邦中，以此类推。

        ``` {#codeblock_u1d_rqa_ive}
        kubefedctl join cluster1 --cluster-context cluster1 \
            --host-cluster-context cluster1 --add-to-registry --v=2
        kubefedctl join cluster2 --cluster-context cluster2 \
            --host-cluster-context cluster1 --add-to-registry --v=2
        kubefedctl join cluster3 --cluster-context cluster3 \
            --host-cluster-context cluster1 --add-to-registry --v=2
        ```

    3.  执行`kubectl get federatedcluster -n federation-system`命令，看到如下信息说明多集群已经加入成功。 

        ``` {#codeblock_eyz_3wg_x9e}
        NAME       READY   AGE
        cluster1   True    23s
        cluster2   True    10s
        ```


